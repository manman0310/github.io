<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Lin Man</title>
    <meta name="description" content="Software Engineer">

    <link rel="stylesheet" href="resource.css">
</head>


<body>
    <div class="code">
        <pre>
            #! /bin/bash
        
            declare APP_KEYWORD
            declare -r GLOBAL_NEXUX="https://nexus.****.net"
            declare -r GLOBAL_NEXUX_BASICAUTH="****"
            
            if [ ! $1 ]; then
                echo "no input parameter for running, generate failed."
                exit 1
            fi
            
            funToGenerateKeystore() {
                echo "APP_KEYWORD is $APP_KEYWORD"
                keytool -genkey -v -storepass $APP_KEYWORD -keypass ****** -storepass ****** -keystore $APP_KEYWORD.keystore -alias $APP_KEYWORD -keyalg RSA -keysize 2048 -validity 10000 -dname "CN=flexemCus,OU=flexemCus,O=flexemCus,L=yangpu,ST=shanghai,C=CN"
                if [ ! -f "$APP_KEYWORD.keystore" ]; then
                    echo "Generate Keystore Failed."
                    exit 4
                else
                    funToUploadKeystore
                fi
            }
            
            funToUploadKeystore() {
                echo "upload $APP_KEYWORD.apk to $APP_KEYWORD file"
                curl -X POST "$GLOBAL_NEXUX/service/rest/v1/components?repository=artifact" -H "accept:application/json" -H "Content-Type:multipart/form-data" -F "raw.directory=fcloud-artifact/project/$APP_KEYWORD" -F "raw.asset1=@$APP_KEYWORD.keystore" -F "raw.asset1.filename=$APP_KEYWORD.keystore" -u "$GLOBAL_NEXUX_BASICAUTH" -v
                if [ $? != 0 ]; then
                    echo "upload to repository failed, generate failed."
                    exit 5
                else
                    exit 0
                fi
            }
            
            while [ -n "$1" ]; do
                case "$1" in
                -a)
                    if [ ! $2 ]; then
                        echo "-a without any value, generate failed."
                        exit 2
                    else
                        APP_KEYWORD=$2
                        echo "APP_KEYWORD is $APP_KEYWORD"
                        funToGenerateKeystore
                    fi
                    ;;
                *)
                    echo "Invalid input parameter, generate failed."
                    exit 3
                    ;;
                esac
                shift
            done
        </pre>
    </div>
</body>

</html>